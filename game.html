<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Face Map Game ‚Äî Fair Hard Mode</title>

<style>
body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;

  touch-action: none;
  overscroll-behavior: none;

  -webkit-user-select: none;
  user-select: none;

  -webkit-touch-callout: none;
}

body{
 margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  overflow:hidden;

  padding-bottom: env(safe-area-inset-bottom);
}
#hud{display:flex;gap:20px;margin-bottom:20px}
canvas{
  background:#000;
  border:3px solid #666;
  border-radius:16px;
  max-width:95vw;
  max-height:65vh;
}
#pad{
  margin-top:2px;
  margin-bottom: calc(20px + env(safe-area-inset-bottom));
  display:grid;
  grid-template-columns:80px 80px 80px;
  grid-template-rows:80px 80px 80px;
  gap:0px;
}
.btn{
  background:#222;
  border:2px solid #444;
  border-radius:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
}
.btn:active{transform:scale(.95)}
.empty{opacity:0}
#overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
}
#overlayBox{
  background:#111;
  border:2px solid #555;
  border-radius:20px;
  padding:26px;
  text-align:center;
}
#restartBtn{
  margin-top:16px;
  padding:10px 24px;
  font-size:18px;
  border-radius:14px;
  border:none;
  background:#2f7bff;
  color:white;
}
</style>
</head>

<body>

<div id="hud">
  <div>‚è±Ô∏è <span id="time">45</span></div>
  <div>üéØ <span id="moves">70</span></div>
  <div>‚ò†Ô∏è x8</div>
</div>

<canvas id="game"></canvas>

<div id="pad">
  <div class="btn empty"></div>
  <div class="btn" data-dx="0" data-dy="-1">‚Üë</div>
  <div class="btn empty"></div>
  <div class="btn" data-dx="-1" data-dy="0">‚Üê</div>
  <div class="btn empty"></div>
  <div class="btn" data-dx="1" data-dy="0">‚Üí</div>
  <div class="btn empty"></div>
  <div class="btn" data-dx="0" data-dy="1">‚Üì</div>
  <div class="btn empty"></div>
</div>

<div id="overlay">
  <div id="overlayBox">
    <h2 id="overlayTitle"></h2>
    <p id="overlayText"></p>
    <button id="restartBtn">Restart üîÅ</button>
  </div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const tile=70,cols=12,rows=12;
canvas.width=cols*tile; canvas.height=rows*tile;

const meImg=new Image(), herImg=new Image();
meImg.src="https://res.cloudinary.com/doin9cdjc/image/upload/v1769801435/Screenshot_2026-01-29_220936_iwmjnw.png";
herImg.src="https://res.cloudinary.com/doin9cdjc/image/upload/v1769801446/Screenshot_2026-01-29_203412_vc2pt7.png";

const timeEl=document.getElementById("time");
const movesEl=document.getElementById("moves");
const overlay=document.getElementById("overlay");
const overlayTitle=document.getElementById("overlayTitle");
const overlayText=document.getElementById("overlayText");

let map,player,goal,dangers;
let timeLeft,movesLeft,gameOver;
let phase=0;
let holdInterval = null;

function inB(x,y){return x>=0&&y>=0&&x<cols&&y<rows}
function dist(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)}

function bfs(){
  const q=[player];
  const seen=Array.from({length:rows},()=>Array(cols).fill(false));
  seen[player.y][player.x]=true;
  while(q.length){
    const c=q.shift();
    if(c.x===goal.x&&c.y===goal.y) return true;
    [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{
      const nx=c.x+dx, ny=c.y+dy;
      if(inB(nx,ny)&&!seen[ny][nx]&&map[ny][nx]===0){
        seen[ny][nx]=true; q.push({x:nx,y:ny});
      }
    });
  }
  return false;
}

function initGame(){
  timeLeft=45; movesLeft=70; gameOver=false;
  timeEl.textContent=timeLeft; movesEl.textContent=movesLeft;
  overlay.style.display="none";

  player={x:0,y:0}; goal={x:cols-1,y:rows-1};

  do{
    map=Array.from({length:rows},()=>Array(cols).fill(0));
    for(let i=0;i<35;i++)
      map[Math.random()*rows|0][Math.random()*cols|0]=1;
    map[player.y][player.x]=0;
    map[goal.y][goal.x]=0;
  }while(!bfs());

  dangers=[];
  while(dangers.length<8){
    const x=Math.random()*cols|0, y=Math.random()*rows|0;
    if(map[y][x]||dist({x,y},player)<7) continue;
    dangers.push({x,y});
  }
  draw();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<rows;y++)
    for(let x=0;x<cols;x++){
      ctx.fillStyle=map[y][x]?"#555":"#1b1b1b";
      ctx.fillRect(x*tile,y*tile,tile-2,tile-2);
    }
  ctx.drawImage(herImg,goal.x*tile+6,goal.y*tile+6,tile-12,tile-12);
  dangers.forEach(d=>{
  ctx.font = `${tile * 0.6}px serif`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("‚ò†Ô∏è", d.x*tile + tile/2, d.y*tile + tile/2);
});
  ctx.drawImage(meImg,player.x*tile+6,player.y*tile+6,tile-12,tile-12);
}

function endGame(win){
  gameOver = true;
  overlay.style.display = "flex";

  overlayTitle.textContent = win ? "‚ù§Ô∏è You made it" : "‚ò†Ô∏è You fell into the shadows";
  overlayText.textContent = win ? "You danced past danger." : "Ready to rise again?";

  if (win) {
    restartBtn.textContent = "Dance Again! ‚ñ∂Ô∏è";
    restartBtn.style.background = "#2f7bff"; // ÿ£ÿ≤ÿ±ŸÇ
  } else {
    restartBtn.textContent = "Rise Againts! üîÅ";
    restartBtn.style.background = "#d63b3b"; // ÿ£ÿ≠ŸÖÿ±
  }
}

function move(dx,dy){
  if(gameOver) return;
  const nx=player.x+dx, ny=player.y+dy;
  if(!inB(nx,ny)||map[ny][nx]) return;
  player.x=nx; player.y=ny;
  movesLeft--; movesEl.textContent=movesLeft;
  if(player.x===goal.x&&player.y===goal.y) endGame(true);
  dangers.forEach(d=>{if(d.x===player.x&&d.y===player.y) endGame(false)});
  if(movesLeft<=0) endGame(false);
  draw();
}

setInterval(()=>{
  if(gameOver) return;
  phase^=1;
  dangers.forEach((d,i)=>{
    if(i%2!==phase) return;
    const opts=[[1,0],[-1,0],[0,1],[0,-1]]
      .map(([dx,dy])=>({x:d.x+dx,y:d.y+dy}))
      .filter(o=>inB(o.x,o.y)&&map[o.y][o.x]===0)
      .sort((a,b)=>dist(a,player)-dist(b,player));
    if(opts[0]){d.x=opts[0].x; d.y=opts[0].y;}
  });
  dangers.forEach(d=>{if(d.x===player.x&&d.y===player.y) endGame(false)});
  draw();
},900);

setInterval(()=>{
  if(gameOver) return;
  timeLeft--; timeEl.textContent=timeLeft;
  if(timeLeft<=0) endGame(false);
},1000);

window.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp") move(0,-1);
  if(e.key==="ArrowDown") move(0,1);
  if(e.key==="ArrowLeft") move(-1,0);
  if(e.key==="ArrowRight") move(1,0);
});
const pad = document.getElementById("pad");

pad.addEventListener("touchstart", (e)=>{
  const b = e.target.closest(".btn");
  if(!b || b.classList.contains("empty")) return;

  const dx = +b.dataset.dx;
  const dy = +b.dataset.dy;

  move(dx, dy); // ÿÆÿ∑Ÿàÿ© ÿ£ŸàŸÑŸâ ŸÅŸàÿ±ÿßŸã
  holdInterval = setInterval(()=> move(dx, dy), 140); // ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ±
}, {passive:true});

pad.addEventListener("touchend", ()=>{
  clearInterval(holdInterval);
  holdInterval = null;
});

pad.addEventListener("touchcancel", ()=>{
  clearInterval(holdInterval);
  holdInterval = null;
});
document.getElementById("restartBtn").onclick=initGame;

meImg.onload=herImg.onload=initGame;

function goFullscreen(){
  if(document.documentElement.requestFullscreen){
    document.documentElement.requestFullscreen();
  }
}

canvas.addEventListener("touchstart", goFullscreen, { once:true });

document.addEventListener("touchmove", (e)=> e.preventDefault(), { passive:false });

</script>

</body>
</html>

